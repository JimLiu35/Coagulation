<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-08-22 Tue 09:04 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Controlling Positive Dynamical Biomolecular Systems</title>
<meta name="author" content="Jim Liu" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">Controlling Positive Dynamical Biomolecular Systems</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orgca9137e">1. Background</a></li>
<li><a href="#orgc3235af">2. Getting Started</a>
<ul>
<li><a href="#orgca48202">2.1. Targeted clinical control of trauma patient coagulation through a thrombin dynamics model</a></li>
<li><a href="#orge9bfcc3">2.2. Personalized modulation of coagulation factors using a thrombin dynamics model to treat trauma-induced coagulopathy</a></li>
<li><a href="#org00e1645">2.3. Control of positive systems with an unknown state-dependent power law input delay and input saturation</a></li>
<li><a href="#orgd5daaf6">2.4. Nonlinear dynamic modeling and model predictive control of thrombin generation to treat trauma-induced coagulopathy</a></li>
</ul>
</li>
<li><a href="#orgd17b5a3">3. Notes for source code</a>
<ul>
<li><a href="#org148fc38">3.1. Personalized modulation of coagulation factors using a thrombin dynamics model to treat trauma-induced coagulopathy</a>
<ul>
<li><a href="#org3739cec">3.1.1. <code>GCM_Algorithm_for_TIC.m</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgca9137e" class="outline-2">
<h2 id="orgca9137e"><span class="section-number-2">1.</span> Background</h2>
<div class="outline-text-2" id="text-1">
<p>
To gain the background knowledge about our current research, please read the following paper in order.
</p>
<ol class="org-ol">
<li><a href="https:www.science.org/doi/10.1126/scitranslmed.aaf5045">Targeted clinical control of trauma patient coagulation through a thrombin dynamics model</a></li>
<li><a href="https://www.nature.com/articles/s41540-021-00202-9">Personalized modulation of coagulation factors using a thrombin dynamics model to treat trauma-induced coagulopathy</a></li>
<li><a href="https:www.sciencedirect.com/science/article/abs/pii/S0005109823000031?via%3Dihub">Control of positive systems with an unknown state-dependent power law input delay and input saturation</a></li>
<li><a href="https:onlinelibrary.wiley.com/doi/10.1002/rnc.5963">Nonlinear dynamic modeling and model predictive control of thrombin generation to treat trauma-induced coagulopathy</a></li>
</ol>
</div>
</div>
<div id="outline-container-orgc3235af" class="outline-2">
<h2 id="orgc3235af"><span class="section-number-2">2.</span> Getting Started</h2>
<div class="outline-text-2" id="text-2">
<p>
The section severs to install or setup necessary scripts to regenerate plots in the aforementioned publications.
</p>
</div>
<div id="outline-container-orgca48202" class="outline-3">
<h3 id="orgca48202"><span class="section-number-3">2.1.</span> Targeted clinical control of trauma patient coagulation through a thrombin dynamics model</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Comming Soon&#x2026;
</p>
</div>
</div>
<div id="outline-container-orge9bfcc3" class="outline-3">
<h3 id="orge9bfcc3"><span class="section-number-3">2.2.</span> Personalized modulation of coagulation factors using a thrombin dynamics model to treat trauma-induced coagulopathy</h3>
<div class="outline-text-3" id="text-2-2">
<p>
The source code for this paper i.e. GCM Algorithm is on our <a href="https://github.com/SYBORGS-Lab/GCM-Algorithm">SYBORG github repository</a>. There is a detailed README file, but if you want, you can follow the following instructions to get the code and necessary third-party package installed on your local machine.
</p>

<p>
The detailed notes for the source codes is available here.
</p>
</div>
</div>
<div id="outline-container-org00e1645" class="outline-3">
<h3 id="org00e1645"><span class="section-number-3">2.3.</span> Control of positive systems with an unknown state-dependent power law input delay and input saturation</h3>
<div class="outline-text-3" id="text-2-3">
<p>
Comming Soon&#x2026;
</p>
</div>
</div>
<div id="outline-container-orgd5daaf6" class="outline-3">
<h3 id="orgd5daaf6"><span class="section-number-3">2.4.</span> Nonlinear dynamic modeling and model predictive control of thrombin generation to treat trauma-induced coagulopathy</h3>
<div class="outline-text-3" id="text-2-4">
<p>
The SimuLink model is available on our lab&rsquo;s Google Drive. Damon uploaded it to his own research ouputs folder and named the corresponding journal as &ldquo;Journal 4&rdquo;. However, the model on the drive need be converted to a &rsquo;.slx&rsquo; file. Otherwise, SimuLink cannot open it. To do this,
</p>
<ol class="org-ol">
<li>Open MATLAB</li>
<li>In MATLAB command window, navigate to this path <code>SYBORGS/Research Outputs and Project Data/Member Specific Data and Output/Damon Ghetmiri/MATLAB Codes/Journal 4/Codes/WB TEG/6 Parameters - Updated/WholeBloodTEGModel_6P_B.slx (Unzipped Files)/</code>;</li>
<li>Then, run <code>!zip -r journal4_simulink.slx '[Content_Types].xml' _rels metadata simulink</code>. You can choose your own filename, but I use <code>journal4_simulink.slx</code>. Then a slx file should be available to you.</li>
<li>To open this SimuLink Model, simply run <code>open_system('journal4_simulink.slx')</code> in the MATLAB command window.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgd17b5a3" class="outline-2">
<h2 id="orgd17b5a3"><span class="section-number-2">3.</span> Notes for source code</h2>
<div class="outline-text-2" id="text-3">
<p>
These notes don&rsquo;t detail every line of the source code but provide supplementary comments, omitting certain trivial parts.
</p>
</div>
<div id="outline-container-org148fc38" class="outline-3">
<h3 id="org148fc38"><span class="section-number-3">3.1.</span> Personalized modulation of coagulation factors using a thrombin dynamics model to treat trauma-induced coagulopathy</h3>
<div class="outline-text-3" id="text-3-1">
</div>
<div id="outline-container-org3739cec" class="outline-4">
<h4 id="org3739cec"><span class="section-number-4">3.1.1.</span> <code>GCM_Algorithm_for_TIC.m</code></h4>
<div class="outline-text-4" id="text-3-1-1">
<ul class="org-ul">
<li><p>
Max, min and mean CAT profiles for normal plasma samples.<br />
The provided code computes the Maximum, Minimum, and Mean CAT profiles, which play a crucial role in establishing the acceptable range for a healthy individual&rsquo;s CAT profile. <code>tf</code> function computes the transfer function of the system, and the output Y (<code>Y_est_Min_Nor, Y_est_Max_Nor, Y_est_Mean_Nor</code>) is a <b>impulse response</b>.
</p>
<div class="org-src-container">
<pre class="src src-matlab">% Mean of Parameters / Max and Min of Fit to Data

sys_est_Min_Nor=tf(Min_ModelParameters_Nor(4),[1 Min_ModelParameters_Nor(3) Min_ModelParameters_Nor(2) Min_ModelParameters_Nor(1)],'InputDelay',Min_ModelParameters_Nor(5));
sys_est_Max_Nor=tf(Max_ModelParameters_Nor(4),[1 Max_ModelParameters_Nor(3) Max_ModelParameters_Nor(2) Max_ModelParameters_Nor(1)],'InputDelay',Max_ModelParameters_Nor(5));
sys_est_Mean_Nor=tf(Mean_ModelParameters_Nor(4),[1 Mean_ModelParameters_Nor(3) Mean_ModelParameters_Nor(2) Mean_ModelParameters_Nor(1)],'InputDelay',Mean_ModelParameters_Nor(5));

T2 = linspace(0,42,124)';
Y_est_Min_Nor = 5*impulse(sys_est_Min_Nor,T2);
Y_est_Max_Nor = 5*impulse(sys_est_Max_Nor,T2);
Y_est_Mean_Nor = 5*impulse(sys_est_Mean_Nor,T2);
</pre>
</div></li>

<li><p>
Normal ranges
</p>
<div class="org-src-container">
<pre class="src src-matlab">%Identify normal range

[Range_peak_Min,i_m]=max(Y_est_Min_Nor);
Range_T_peak_Min= T2(i_m) ;
Range_Area_Min= trapz(T2,Y_est_Min_Nor ) ;
Range_Delay_Min=DetermineDelayTherapy(T2,Y_est_Min_Nor);

[Range_peak_Max,i_m]=max(Y_est_Max_Nor);
Range_T_peak_Max= T2(i_m) ;
Range_Area_Max= trapz(T2,Y_est_Max_Nor ) ;
Range_Delay_Max=DetermineDelayTherapy(T2,Y_est_Max_Nor);

[Range_peak_Mean,i_m]=max(Y_est_Mean_Nor);
Range_T_peak_Mean= T2(i_m) ;
Range_Area_Mean= trapz(T2,Y_est_Mean_Nor ) ;
Range_Delay_Mean=DetermineDelayTherapy(T2,Y_est_Mean_Nor);

Range_Peak=[Range_peak_Min Range_peak_Mean Range_peak_Max];
Range_T_Peak=[Range_T_peak_Max Range_T_peak_Mean Range_T_peak_Min];
Range_Area=[Range_Area_Min Range_Area_Mean Range_Area_Max];
Range_Delay=[Range_Delay_Max Range_Delay_Mean Range_Delay_Min];
</pre>
</div>
<ol class="org-ol">
<li>This part calculates the ranges for the Peak value, Peak time, Delay time, and the Area under the curve.</li>
<li>The area is calculated via trapezoidal method, an approximation of integral.</li>
<li>NOTE: Damon created 4 vectors to store the min, max, and mean values for each model parameters, but the order are not the same. The order for <code>Range_Peak</code> is <b>min &#x2013;&gt; max &#x2013;&gt; mean</b>, but the order for <code>Range_T_Peak</code> is <b>max &#x2013;&gt; mean &#x2013;&gt; min</b>. One possible reason is when Peak achieves its minimum value, the time to reach the peak value is at its maximum value.</li>
</ol></li>

<li><p>
Model parameters initialization
</p>
<div class="org-src-container">
<pre class="src src-matlab">%% CAT Variation with factor recommendation adjustments Sample by sample
T3 = linspace(0,42,42001)';
FactorConcentration_History_TraSample=[];
Factor_tag={'II', 'V', 'VII' , 'IX', 'X', 'VIII', 'ATIII', 'PC'};
FactorConcentration_History_TraSample=[FactorConcentration_History_TraSample; factor_concen_Tra_sample_initial];
</pre>
</div>
<p>
The last line of this code block seems decalre a 2x8 matrix, but since the <code>FactorConcentration_History_TraSample</code> is declared as <code>[]</code> i.e. empty. Thus, at current stage, this matrix is only a 1x8 vector containing all initial factor concentrations of the trauma patient, i.e. <code>factor_concen_Tra_sample_initial</code>.
</p></li>

<li><p>
QUESTION: Why do we need to half the factor VIII concentration if it exceeds 400?
</p>
<div class="org-src-container">
<pre class="src src-matlab">%STEP 1: Correct factor V to normal range
if FactorConcentration_History_TraSample(1,6)&gt;400
    FactorConcentration_History_TraSample(1,6)=FactorConcentration_History_TraSample(1,6)/2;
end
</pre>
</div></li>
<li><p>
Step 3 to 6, adjust individual factor concentration. Code for these steps are almost the same. The only difference lies in which model parameters are used to polyfit against the factor concentrations.
</p>

<div class="org-src-container">
<pre class="src src-matlab">%STEP 3: adjusting factor II to correct peak

j=1; %Factor II
Factor_Tra_changes_treat={};

factor_concen_Tra_sample=FactorConcentration_History_TraSample(end,:);
Delta_parameter=factor_concen_Tra_sample(j)/10 ;

%Estimate the CAT model using the update coagulation factor set
Trau_1_coeff=factor_concen_Tra_sample*factor_coeff_All_Train+const_All_Train;
sys_est_change_Tra1=tf(Trau_1_coeff(4),[1 Trau_1_coeff(3) Trau_1_coeff(2) Trau_1_coeff(1)],'InputDelay',Trau_1_coeff(5));

Y_est_change_Tra= 5*impulse(sys_est_change_Tra1,T3);
[Y_est_change_Tra_peak,i_m]=max(Y_est_change_Tra);
T_est_change_Tra_peak= T3(i_m) ;
AreaUnderCurve= trapz(T3,Y_est_change_Tra ) ;
DelayCurve=DetermineDelayTherapy(T3,Y_est_change_Tra);

Factor_Tra_changes_treat{1,j}=[factor_concen_Tra_sample(j) Y_est_change_Tra_peak T_est_change_Tra_peak AreaUnderCurve DelayCurve];
</pre>
</div>
<p>
First of all, Damon created an empty cell array <code>Factor_Tra_changes_treat</code>, this cell array will contain all important model parameters associated with changing one factor concentration. For example, in Step 3 we are adjusting factor II, and thus the current factor II&rsquo;s concentration with all system parameters, Peak, Peak Time, Area, Time Delay, will be filled into this cell array, i.e. <code>Factor_Tra_changes_treat{1,j}</code>. This is what the last line of code in this block means.<br />
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>

<colgroup>
<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Factor Concentration</th>
<th scope="col" class="org-left">Peak</th>
<th scope="col" class="org-left">Peak Time</th>
<th scope="col" class="org-left">Area Under the Curve</th>
<th scope="col" class="org-left">Time Delay</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">Original</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">-10%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">+10%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">-20%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">+20%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">-30%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">+30%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">-40%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">+40%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">-50%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-right">+50%</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
<p>
<br />
After declared this empty cell array, he get the latest concentration values for all factors and then calculate the increment (i.e. 10% of the current factor concentrations).<br />
<br />
Next, he did a linear mapping from patient&rsquo;s current factor concentrations to a set of estimated coefficients, \([K_{0}, K_{1}, K_{2}, K_{n}, K_{d}]\), to generate an updated system transfer function.<br />
<br />
Then, find the impulse response of this new transfer function.
</p>

<div class="org-src-container">
<pre class="src src-matlab">% Forming the mappifng function from factor concentration to graph parameter

    for i=1:10

        factor_concen_Tra_sample=FactorConcentration_History_TraSample(end,:);
        FactorSelected=factor_concen_Tra_sample(j);
        change_parameter= ((-1)^i)*Delta_parameter*(ceil(i/2)) ;
        FactorSelected=FactorSelected+change_parameter ;
        factor_concen_Tra_sample(j)=FactorSelected;
        Trau_1_coeff=factor_concen_Tra_sample*factor_coeff_All_Train+const_All_Train;
        sys_est_change_Tra1=tf(Trau_1_coeff(4),[1 Trau_1_coeff(3) Trau_1_coeff(2) Trau_1_coeff(1)],'InputDelay',Trau_1_coeff(5));
        Y_est_change_Tra= 5*impulse(sys_est_change_Tra1,T3);

        [Y_est_change_Tra_peak,i_m]=max(Y_est_change_Tra);
        T_est_change_Tra_peak= T3(i_m) ;
        AreaUnderCurve= trapz(T3,Y_est_change_Tra ) ;
        DelayCurve=DetermineDelayTherapy(T3,Y_est_change_Tra);

        Factor_Tra_changes_treat{i+1,j}=[FactorSelected Y_est_change_Tra_peak T_est_change_Tra_peak AreaUnderCurve DelayCurve];


    end
</pre>
</div>
<p>
This <code>for</code> loop corresponds to the GCM tuning process. It starting from -50% to +50% with 10% increments. Two important notes:
</p>
<ol class="org-ol">
<li>This tuning process is not going sequentially. In other words, it is not proceeding as -50%, -40%, &#x2026; +40%, + 50%. Instead, it jumps from -10% to +10%, then -20% to +20%, and so on.</li>
<li><p>
Damon reset the <code>factor_concen_Tra_sample</code> vector for every single loop. He did this because when he re-estimated the system&rsquo;s transfer function, he changed the corresponding factor concentration in <code>factor_concen_Tra_sample</code>. As the new factor concentration in the next iteration was based upon the original value, he had to reset the vector whenever a new iteration started.
</p>

<div class="org-src-container">
<pre class="src src-matlab">  Factor_Tra_changes_treat_Mat=cell2mat(Factor_Tra_changes_treat);
  factor_param_fit=polyfit(Factor_Tra_changes_treat_Mat(:,2),Factor_Tra_changes_treat_Mat(:,1),2); %a second order polynomial from peak to factor II
  recommend_factor_update=min(max(60, polyval(factor_param_fit, Range_Peak(2))),140);

  FactorConcentration_History_TraSample=[FactorConcentration_History_TraSample; FactorConcentration_History_TraSample(end,:)];
  FactorConcentration_History_TraSample(end,j)=recommend_factor_update;
</pre>
</div>
<p>
Since the most significant impacts on the CAT Peak arise from changes in factor II, Damon chose to fit the factor II concentrations using a 2nd order polynomial against the peak values, i.e. <code>polyfit(X, Y, N) = polyfit(peak_values, factorII_concen, 2)</code>. Then, by given the mean value of peak (i.e. <code>Range_Peak(2)</code>), the <code>polyval</code> function outputs the corresponding factor II concentration to achieve the mean peak value. Finally, compare the <code>polyval</code> output with the boundaries (60 and 140), and update the recommend factor concentration.
</p></li>
</ol></li>
<li>QUESTION: Step 4 adjusts factor X. Similar to step 3, Damon fits the factor X concentrations using a 2nd order polynomial against the peak values. However, in paper, Damon claimed that factor X supplement the peak correct of factor II coz it may be saturated. It also compensates the peak time and affects the time delay. The algorithm does neither manifest when factor II will be saturated nor does it consider the impacts factor X have on peak time and time delay. In addition, the step 4 title, <code>%STEP 4: adding factor X to correct peak and peak time</code>, specifically states peak-time correction, but nothing in this part of code related to peak time! <b>This problem may be trivial but it does not make sense!</b></li>
<li>QUESTION: After step 6, Damon re-adjust the factor II? Why??? Mistake?</li>
<li><p>
Step 7 (optional) additional adjustment
First of all, Damon regenerated the normal systems&rsquo; impulse responses, namely <code>Y_est_Min_Nor_Comparison</code>, <code>Y_est_Max_Nor_Comparison</code>, and <code>Y_est_Mean_Nor_Comparison</code>. Instead of using T2, this time he used T3. They share the same time range but different resolutions. Then he recalculated the ranges for the four model parameters. <br />
<br />
Next, he got the latest estimated CAT profile based on the recommended factor concentrations obtained after step 6.<br />
<br />
With both normal and recommended profiles, he initiated a comparing process to check the necessities of adjusting factor ATIII and Protein C. Here is the corresponding code block.
</p>
<div class="org-src-container">
<pre class="src src-matlab">% Identify if peak is in the range
if Peak_current_Tra&gt;Range_Peak(3)
    Current_CAT_Peak_Indicator=1; % Exceed the normal range
elseif Range_Peak(1)&gt;Peak_current_Tra
    Current_CAT_Peak_Indicator=-1; % Below the normal range
else
    Current_CAT_Peak_Indicator=0; % Within the normal range
end
% Identify if tail (between 10 and 20 minutes) is in the range
if mean(Y_est_current_Tra(12500:22500)-Y_est_Max_Nor_Comparison(12500:22500))&gt;0
    Current_CAT_Tail_Indicator=1;
elseif mean(Y_est_current_Tra(8000:18000)-Y_est_Min_Nor_Comparison(8000:18000))&lt;0
    Current_CAT_Tail_Indicator=-1;
else
    Current_CAT_Tail_Indicator=0;
end
</pre>
</div>

<p>
Here arise a QUESTION. In the paper, Damon said in step 7, the decision was made based upon two model parameters, Peak and Thrombin potential (area under the curve). Instead of using area, he used the impulse responses from time step 12500 to 22500. Why not just using the <code>trapz</code> function to directly calculate the area? <br />
</p>

<p>
If additional adjustments are required, figuring out which factor we&rsquo;d like to change follows next.
</p>
<div class="org-src-container">
<pre class="src src-matlab">%CHoose what factor to change
if Current_CAT_Peak_Indicator==1 &amp;&amp; Current_CAT_Tail_Indicator~=-1
    j=8;
    Target_Peak_Value=mean(Range_Peak(2:3));
    NeedForStep6=1;
elseif Current_CAT_Peak_Indicator==1 &amp;&amp; Current_CAT_Tail_Indicator==-1
    if FactorConcentration_History_TraSample(end,5)~=140
        j=5;
    else
        j=7;
    end
    Target_Peak_Value=mean(Range_Peak(2:3));
    NeedForStep6=1;
elseif Current_CAT_Peak_Indicator==-1 &amp;&amp; Current_CAT_Tail_Indicator==-1
    j=7;
    Target_Peak_Value=mean(Range_Peak(2));
    NeedForStep6=1;
elseif Current_CAT_Peak_Indicator==0 &amp;&amp; Current_CAT_Tail_Indicator==+1
    j=7;
    Target_Peak_Value=Range_Peak(2);
    NeedForStep6=1;
elseif Current_CAT_Peak_Indicator==0 &amp;&amp; Current_CAT_Tail_Indicator==-1
    j=7;
    Target_Peak_Value=Range_Peak(2);
    NeedForStep6=1;
elseif Current_CAT_Peak_Indicator==-1 &amp;&amp; Current_CAT_Tail_Indicator==0
    FactorConcentration_History_TraSample(end,6)=(FactorConcentration_History_TraSample(5,6)+FactorConcentration_History_TraSample(4,6))/9*5;
    NeedForStep6=0;
else
    NeedForStep6=0;
end
</pre>
</div>
<p>
QUESTION: the <code>Target_Peak_Value</code> is set to the average of mean and maximum value, why is that? <br />
QUESTION: In paper, step 7 only adjusts factor ATIII or Protein C, why there is a case that it allows to adjust factor X (i.e. j = 5)?
</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Jim Liu</p>
<p class="date">Created: 2023-08-22 Tue 09:04</p>
</div>
</body>
</html>